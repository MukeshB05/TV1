<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Streaming Platform with Categories</title>
<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
  body {
    margin: 0;
    background: #111;
    font-family: Arial, sans-serif;
    color: #fff;
  }
  body.dark-mode {
    background-color: #fff;
    color: #000;
  }

  #player-container {
    position: relative;
    max-width: 100%;
    height: 60vh;
    background: black;
  }

  #video, #adVideo {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  #controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px;
    background: rgba(0,0,0,0.6);
  }

  .control-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    padding: 5px 10px;
  }
  .control-btn:hover {
    color: #0ff;
  }

  #progress-container {
    width: 100%;
    height: 5px;
    background: #444;
    cursor: pointer;
  }

  #progress {
    height: 100%;
    background: #0ff;
    width: 0;
  }

  #adOverlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.8);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
  }

  #adVideo {
    max-width: 80%;
    max-height: 60%;
  }

  #adProgressContainer {
    width: 80%;
    height: 5px;
    background: #444;
    margin-top: 10px;
  }

  #adProgress {
    height: 100%;
    background: #0ff;
    width: 0;
  }

  #skipAdBtn {
    margin-top: 10px;
    padding: 5px 10px;
    background: #0ff;
    border: none;
    cursor: pointer;
    font-weight: bold;
  }

  #extraControls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
  }

  input[type=range] {
    cursor: pointer;
  }

  #timeDisplay {
    margin-left: auto;
    font-size: 12px;
  }

  #categorySelectorContainer {
    padding: 10px;
    background: #222;
  }

  #categorySelect {
    padding: 5px;
    font-size: 16px;
  }

  @media(max-width: 768px) {
    #player-container {
      height: 40vh;
    }
  }
</style>
</head>
<body>

<!-- Category Selector -->
<div id="categorySelectorContainer">
  <label for="categorySelect" style="color:white;">Select Category:</label>
  <select id="categorySelect"></select>
</div>

<div id="player-container">
  <video id="video" controls></video>
  <div id="adOverlay">
    <video id="adVideo" muted></video>
    <div id="adProgressContainer"><div id="adProgress"></div></div>
    <button id="skipAdBtn" disabled>Skip Ad</button>
  </div>
</div>

<!-- Controls -->
<div id="controls">
  <button class="control-btn" id="playPauseBtn" title="Play/Pause"><i class="fas fa-play"></i></button>
  <button class="control-btn" id="muteBtn" title="Mute/Unmute"><i class="fas fa-volume-up"></i></button>
  <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1" title="Volume"/>
  <button class="control-btn" id="pipBtn" title="Picture-in-Picture"><i class="fas fa-tv"></i></button>
  <button class="control-btn" id="fullscreenBtn" title="Fullscreen"><i class="fas fa-expand"></i></button>
  <button class="control-btn" id="bookmarkBtn" title="Add to Favorites"><i class="fas fa-star"></i></button>
  <button class="control-btn" id="darkModeBtn" title="Dark Mode"><i class="fas fa-moon"></i></button>
  <button class="control-btn" id="shareBtn" title="Share"><i class="fas fa-share-alt"></i></button>
  <!-- Progress bar -->
  <div id="progress-container" style="flex:1; margin:0 10px;">
    <div id="progress"></div>
  </div>
  <!-- Extra controls -->
  <div id="extraControls">
    <label style="color:white;">Quality:</label>
    <select id="qualityMenu"></select>
    <label style="color:white;">Brightness</label>
    <input type="range" min="50" max="150" value="100" id="brightnessRange" title="Brightness"/>
    <label style="color:white;">Contrast</label>
    <input type="range" min="50" max="150" value="100" id="contrastRange" title="Contrast"/>
    <button class="control-btn" id="toggleFiltersBtn" title="Toggle Filters"><i class="fas fa-adjust"></i></button>
  </div>
  <div id="timeDisplay">00:00 / 00:00</div>
</div>

<!-- Additional features -->
<div id="additionalFeatures" style="padding:10px; display:flex; gap:10px; flex-wrap:wrap;">
  <button class="control-btn" id="autoPlayNextBtn" title="Auto Play Next Channel"><i class="fas fa-forward"></i></button>
  <button class="control-btn" id="favoriteListBtn" title="View Favorites"><i class="fas fa-list"></i></button>
  <button class="control-btn" id="toggleDarkModeBtn" title="Toggle Dark Mode"><i class="fas fa-moon"></i></button>
</div>

<!-- Quality label -->
<div style="padding:10px; color:white;">
  Current Quality: <span id="currentQualityLabel">Auto</span>
</div>

<script>
  // Sample channel data organized by categories
const channelsByCategory = [
  {
    category: "News",
    channels: [
      { name: "Channel 1", url: "https://www.w3schools.com/html/mov_bbb.mp4" },
      { name: "Channel 2", url: "https://www.w3schools.com/html/movie.mp4" },
    ]
  },
  {
    category: "Sports",
    channels: [
      { name: "Channel 3", url: "https://www.w3schools.com/html/mov_bbb.mp4" },
      { name: "Channel 4", url: "https://www.w3schools.com/html/movie.mp4" },
    ]
  },
  {
    category: "Music",
    channels: [
      { name: "Channel 5", url: "https://www.w3schools.com/html/mov_bbb.mp4" },
      { name: "Channel 6", url: "https://www.w3schools.com/html/movie.mp4" },
    ]
  }
];

const categorySelect = document.getElementById('categorySelect');
const channelList = document.getElementById('channelList');

const video = document.getElementById("video");
const adVideo = document.getElementById("adVideo");
const adOverlay = document.getElementById("adOverlay");
const adProgress = document.getElementById("adProgress");
const skipAdBtn = document.getElementById("skipAdBtn");

const playPauseBtn = document.getElementById("playPauseBtn");
const muteBtn = document.getElementById("muteBtn");
const volumeSlider = document.getElementById("volumeSlider");
const pipBtn = document.getElementById("pipBtn");
const fullscreenBtn = document.getElementById("fullscreenBtn");
const bookmarkBtn = document.getElementById("bookmarkBtn");
const darkModeBtn = document.getElementById("darkModeBtn");
const shareBtn = document.getElementById("shareBtn");
const progressContainer = document.getElementById("progress-container");
const progress = document.getElementById("progress");
const qualityMenu = document.getElementById("qualityMenu");
const currentQualityLabel = document.getElementById("currentQualityLabel");
const brightnessRange = document.getElementById("brightnessRange");
const contrastRange = document.getElementById("contrastRange");
const toggleFiltersBtn = document.getElementById("toggleFiltersBtn");
const timeDisplay = document.getElementById("timeDisplay");
const autoPlayNextBtn = document.getElementById("autoPlayNextBtn");
const favoriteListBtn = document.getElementById("favoriteListBtn");
const toggleDarkModeBtn = document.getElementById("toggleDarkModeBtn");

// Initialize
function init() {
  populateCategories();
  loadChannelFromCategory(0);
  setEventListeners();
  updateTimeDisplay();
  startProgressUpdate();
}

function populateCategories() {
  categorySelect.innerHTML = "";
  channelsByCategory.forEach((cat, index) => {
    const option = document.createElement('option');
    option.value = index;
    option.textContent = cat.category;
    categorySelect.appendChild(option);
  });
}

function displayChannels(index) {
  channelList.innerHTML = "";
  const channels = channelsByCategory[index].channels;
  channels.forEach((channel, chIndex) => {
    const li = document.createElement('li');
    li.textContent = channel.name;
    li.style.cursor = 'pointer';
    li.style.padding = '5px';
    li.style.borderBottom = '1px solid #444';
    li.onclick = () => {
      loadChannel(channel.url);
    };
    channelList.appendChild(li);
  });
}

function loadChannel(url) {
  video.src = url;
  video.load();
  video.play();
}

function loadChannelFromCategory(categoryIndex) {
  displayChannels(categoryIndex);
  // Load first channel in category by default
  const firstChannel = channelsByCategory[categoryIndex].channels[0];
  loadChannel(firstChannel.url);
}

categorySelect.onchange = () => {
  loadChannelFromCategory(parseInt(categorySelect.value));
}

// Play/Pause toggle
function togglePlayPause() {
  if (isAdPlaying) return;
  if (video.paused) {
    video.play();
  } else {
    video.pause();
  }
}
function updatePlayPauseIcon() {
  playPauseBtn.innerHTML = video.paused ? '<i class="fas fa-play"></i>' : '<i class="fas fa-pause"></i>';
}

// Mute toggle
function toggleMute() {
  video.muted = !video.muted;
  if (video.muted || video.volume === 0) {
    muteBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
  } else {
    muteBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
  }
}

// Seek video
function seekVideo(e) {
  const rect = progressContainer.getBoundingClientRect();
  const clickX = e.clientX - rect.left;
  const width = rect.width;
  const percent = clickX / width;
  video.currentTime = percent * video.duration;
}

// Update progress bar
function startProgressUpdate() {
  setInterval(() => {
    if (!video.paused && !isAdPlaying) {
      const percent = (video.currentTime / video.duration) * 100;
      progress.style.width = percent + "%";
    }
  }, 500);
}

// Update time display
function updateTimeDisplay() {
  const current = formatTime(video.currentTime);
  const total = formatTime(video.duration);
  timeDisplay.textContent = `${current} / ${total}`;
}
function formatTime(seconds) {
  if (isNaN(seconds)) return "00:00";
  const m = Math.floor(seconds / 60);
  const s = Math.floor(seconds % 60);
  return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
}

// Quality menu
function populateQualityMenu() {
  qualityMenu.innerHTML = "";
  const autoOption = document.createElement("option");
  autoOption.value = -1;
  autoOption.textContent = "Auto";
  qualityMenu.appendChild(autoOption);
  const qualities = [240, 360, 480, 720, 1080];
  qualities.forEach(q => {
    const option = document.createElement("option");
    option.value = q;
    option.textContent = q + "p";
    qualityMenu.appendChild(option);
  });
  qualityMenu.value = -1;
  currentQualityLabel.textContent = "Auto";
}

function changeQuality() {
  const value = parseInt(qualityMenu.value);
  if (value === -1) {
    currentQualityLabel.textContent = "Auto";
  } else {
    currentQualityLabel.textContent = value + "p";
  }
}

// Toggle filters
let filtersEnabled = false;
function toggleFilters() {
  filtersEnabled = !filtersEnabled;
  if (!filtersEnabled) {
    video.style.filter = "none";
  } else {
    updateVideoFilters();
  }
}
function updateVideoFilters() {
  const brightness = brightnessRange.value;
  const contrast = contrastRange.value;
  if (filtersEnabled) {
    video.style.filter = `brightness(${brightness}%) contrast(${contrast}%)`;
  }
}

// Fullscreen
function toggleFullscreen() {
  if (!document.fullscreenElement) {
    video.requestFullscreen().catch(console.log);
  } else {
    document.exitFullscreen();
  }
}

// PiP
async function togglePiP() {
  if (document.pictureInPictureElement) {
    await document.exitPictureInPicture();
  } else {
    try {
      await video.requestPictureInPicture();
    } catch (err) {
      alert("PiP not supported");
    }
  }
}

// Bookmark
function toggleFavorite() {
  let favs = JSON.parse(localStorage.getItem('favorites') || '[]');
  const channelName = getCurrentChannelName();
  if (favs.includes(channelName)) {
    favs = favs.filter(c => c !== channelName);
    alert("Removed from favorites");
  } else {
    favs.push(channelName);
    alert("Added to favorites");
  }
  localStorage.setItem('favorites', JSON.stringify(favs));
}

function getCurrentChannelName() {
  // Find current channel name based on URL
  const currentUrl = video.src;
  for (const category of channelsByCategory) {
    for (const ch of category.channels) {
      if (ch.url === currentUrl) return ch.name;
    }
  }
  return "Unknown";
}

// Load favorites
function loadFavorites() {
  // For now, do nothing
}

// Show favorites list
function showFavorites() {
  const favs = JSON.parse(localStorage.getItem('favorites') || '[]');
  alert("Favorites:\n" + favs.join("\n"));
}

// Share
function shareChannel() {
  const channelName = getCurrentChannelName();
  const url = window.location.href;
  const shareText = `Watch ${channelName} on T Play! ${url}`;
  if (navigator.share) {
    navigator.share({ title: 'T Play', text: shareText }).catch(console.error);
  } else {
    prompt('Copy this link:', url);
  }
}

// Dark mode
function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
}

// Show ad
let isAdPlaying = false;
let adTimer;
let adProgressInterval;
function showAd() {
  if (isAdPlaying) return;
  isAdPlaying = true;
  video.pause();
  document.getElementById("adOverlay").style.display = "flex";

  const adVideos = [
    "https://www.w3schools.com/html/mov_bbb.mp4",
    "https://www.w3schools.com/html/movie.mp4"
  ];

  const randomAd = adVideos[Math.floor(Math.random() * adVideos.length)];
  adVideo.src = randomAd;
  adVideo.load();
  adVideo.play().catch(e => {
    console.error("Ad playback error:", e);
    finishAd();
  });

  // Reset skip button
  skipAdBtn.disabled = true;
  let skipTime = 8;
  skipAdBtn.textContent = `Skip Ad (${skipTime}s)`;
  if (adTimer) clearInterval(adTimer);
  adTimer = setInterval(() => {
    skipTime--;
    if (skipTime > 0) {
      skipAdBtn.textContent = `Skip Ad (${skipTime}s)`;
    } else {
      clearInterval(adTimer);
      skipAdBtn.textContent = "Skip Ad";
      skipAdBtn.disabled = false;
    }
  }, 1000);

  adVideo.addEventListener('loadedmetadata', () => {
    startAdProgress();
  });
  adVideo.addEventListener("ended", finishAd);
}

// Finish ad
function finishAd() {
  isAdPlaying = false;
  document.getElementById("adOverlay").style.display = "none";
  video.play();
  scheduleNextAd();
}

// Schedule next ad
function scheduleNextAd() {
  const intervalSeconds = Math.floor(Math.random() * 3) + 5; // 5-7 sec
  clearTimeout(adIntervalId);
  adIntervalId = setTimeout(() => {
    showAd();
  }, intervalSeconds * 1000);
}

let adIntervalId;
function startAdProgress() {
  if (adProgressInterval) clearInterval(adProgressInterval);
  adProgress.style.width = "0%";
  adProgressInterval = setInterval(() => {
    let elapsed = adVideo.currentTime;
    const percent = Math.min((elapsed / adVideo.duration) * 100, 100);
    adProgress.style.width = percent + "%";
  }, 100);
}

// Toggle filters
let filtersActive = false;
function toggleFilters() {
  filtersActive = !filtersActive;
  if (!filtersActive) {
    video.style.filter = "none";
  } else {
    updateVideoFilters();
  }
}

function updateVideoFilters() {
  const brightness = brightnessRange.value;
  const contrast = contrastRange.value;
  if (filtersActive) {
    video.style.filter = `brightness(${brightness}%) contrast(${contrast}%)`;
  }
}

// Event Listeners
function setEventListeners() {
  // Play/Pause
  document.getElementById("playPauseBtn").addEventListener("click", togglePlayPause);
  video.addEventListener("click", togglePlayPause);
  video.addEventListener("play", () => { isPlaying = true; updatePlayPauseIcon(); });
  video.addEventListener("pause", () => { isPlaying = false; updatePlayPauseIcon(); });
  // Mute
  document.getElementById("muteBtn").addEventListener("click", toggleMute);
  volumeSlider.addEventListener("input", () => {
    video.volume = parseFloat(volumeSlider.value);
    if (video.volume === 0) {
      video.muted = true;
      document.getElementById("muteBtn").innerHTML = '<i class="fas fa-volume-mute"></i>';
    } else {
      video.muted = false;
      document.getElementById("muteBtn").innerHTML = '<i class="fas fa-volume-up"></i>';
    }
  });
  // Progress seek
  document.getElementById("progress-container").addEventListener("click", seekVideo);
  // Time update
  video.addEventListener("timeupdate", updateTimeDisplay);
  // Ended
  video.addEventListener("ended", () => {
    if (autoPlayNextBtn.dataset.enabled === "true") {
      loadChannel(channelsByCategory[categorySelect.value].channels[0].url);
    }
  });
  // PiP
  document.getElementById("pipBtn").addEventListener("click", togglePiP);
  // Fullscreen
  document.getElementById("fullscreenBtn").addEventListener("click", toggleFullscreen);
  // Bookmark
  document.getElementById("bookmarkBtn").addEventListener("click", toggleFavorite);
  // Dark Mode
  document.getElementById("darkModeBtn").addEventListener("click", toggleDarkMode);
  document.getElementById("toggleDarkModeBtn").addEventListener("click", toggleDarkMode);
  // Share
  document.getElementById("shareBtn").addEventListener("click", shareChannel);
  // Quality menu
  document.getElementById("qualityMenu").addEventListener("change", changeQuality);
  // Filters toggle
  document.getElementById("toggleFiltersBtn").addEventListener("click", toggleFilters);
  // Brightness & Contrast
  document.getElementById("brightnessRange").addEventListener("input", updateVideoFilters);
  document.getElementById("contrastRange").addEventListener("input", updateVideoFilters);
  // Additional features
  document.getElementById("autoPlayNextBtn").addEventListener("click", () => {
    const enabled = document.getElementById("autoPlayNextBtn").dataset.enabled === "true";
    document.getElementById("autoPlayNextBtn").dataset.enabled = (!enabled).toString();
    document.getElementById("autoPlayNextBtn").innerHTML = enabled ? '<i class="fas fa-forward"></i>' : '<i class="fas fa-forward"></i> Auto Off';
  });
  document.getElementById("favoriteListBtn").addEventListener("click", showFavorites);
  // Skip ad
  document.getElementById("skipAdBtn").addEventListener("click", finishAd);
}

// Initialize
init();
</script>
</body>
</html>
